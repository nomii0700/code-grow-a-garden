local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- 1. UI SETUP
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltimateSpy"
if gethui then ScreenGui.Parent = gethui() else ScreenGui.Parent = CoreGui end

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 400)
Frame.Position = UDim2.new(0.5, -200, 0.5, -200)
Frame.BackgroundColor3 = Color3.fromRGB(10, 15, 25)
Frame.BorderColor3 = Color3.fromRGB(0, 255, 255)
Frame.BorderSizePixel = 2
Frame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "REMOTE SPY (NO FILTERS)"
Title.TextColor3 = Color3.fromRGB(0, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = Frame

local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, -20, 1, -50)
Scroll.Position = UDim2.new(0, 10, 0, 45)
Scroll.BackgroundTransparency = 0.8
Scroll.Parent = Frame
Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local Layout = Instance.new("UIListLayout")
Layout.Parent = Scroll
Layout.Padding = UDim.new(0, 5)

-- Function to create a button for a captured remote
local function CreateButton(remote, args, method)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 50)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.Text = "CAPTURED: " .. remote.Name .. "\n(Click to Auto-Claim 1-100)"
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 14
    btn.Parent = Scroll
    
    btn.MouseButton1Click:Connect(function()
        btn.Text = "RUNNING (Check Inventory)..."
        btn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        
        -- THE INTELLIGENT REPLAYER
        task.spawn(function()
            for i = 1, 100 do
                -- We take the arguments you sent, and try to swap any number we find with the loop number
                local newArgs = {}
                local replaced = false
                
                for _, val in pairs(args) do
                    if type(val) == "number" then
                        table.insert(newArgs, i) -- Replace number with 1, 2, 3...
                        replaced = true
                    else
                        table.insert(newArgs, val)
                    end
                end
                
                -- If no number was found in the click, we just add the number at the end
                if not replaced then
                    table.insert(newArgs, i)
                end
                
                -- Fire it back to the server
                if method == "FireServer" then
                    remote:FireServer(unpack(newArgs))
                elseif method == "InvokeServer" then
                    remote:InvokeServer(unpack(newArgs))
                end
                
                if i % 20 == 0 then task.wait(0.1) end
            end
            btn.Text = "DONE! Try checking Pass."
        end)
    end)
end

-- 2. THE HOOK (Catches everything)
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Verify it's a Remote firing
    if (method == "FireServer" or method == "InvokeServer") then
        -- Ignore chat messages and movement updates to reduce lag
        if self.Name ~= "SayMessageRequest" 
           and self.Name ~= "DefaultChatSystemChatEvents" 
           and self.Name ~= "Update" 
           and self.Name ~= "Move" then
            
            -- CREATE BUTTON ON UI
            -- We use pcall to ensure UI errors don't break the game
            pcall(function()
                CreateButton(self, args, method)
            end)
        end
    end

    return oldNamecall(self, ...)
end)

-- Close Button
local Close = Instance.new("TextButton")
Close.Size = UDim2.new(0, 30, 0, 30)
Close.Position = UDim2.new(1, -30, 0, 0)
Close.Text = "X"
Close.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
Close.Parent = Frame
Close.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
